name: Release workflow trigger

on:
  issue_comment:
    types: [created]

jobs:
  release:
    # 1. PRì´ ì•„ë‹ˆê³ , ì œëª©ì´ ì§€ì •ëœ í˜•ì‹ì´ë©°, ì½”ë©˜íŠ¸ê°€ '/start'ë¡œ ì‹œì‘í•˜ê³ ,
    # 2. ì‘ì„±ìê°€ ì €ì¥ì†Œ ì†Œìœ ì(OWNER) ë˜ëŠ” í˜‘ë ¥ì(COLLABORATOR, MEMBER)ì¸ ê²½ìš°ì—ë§Œ ì‹¤í–‰
    if: |
      !github.event.issue.pull_request && 
      startsWith(github.event.issue.title, 'ğŸ¤ [Release]') &&
      startsWith(github.event.comment.body, '/start') &&
      contains(fromJSON('["OWNER", "MEMBER", "COLLABORATOR"]'), github.event.comment.author_association)
    
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Parse and Run
        env:
          GH_TOKEN: ${{ github.token }}
          COMMENT_BODY: ${{ github.event.comment.body }}
          ISSUE_NUMBER: ${{ github.event.issue.number }}
        run: |
          VERSION=$(echo "$COMMENT_BODY" | awk '{print $2}')
          
          if [ -z "$VERSION" ]; then
            gh issue comment $ISSUE_NUMBER --body "âŒ ë²„ì „ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: /start v1.2.3)"
            exit 1
          fi

          gh issue comment $ISSUE_NUMBER --body "ğŸš€ **Release $VERSION**ì„ ì‹œì‘í•©ë‹ˆë‹¤."
          # ì´í›„ ë°°í¬ ë¡œì§ ì‹¤í–‰...
